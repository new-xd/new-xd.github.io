---
layout:     post
title:      "Cordova Plugin开发"
subtitle:   "终于可以写插件了"
date:       2016-01-10 21:33:00+0800
author:     "New"
header-img: ""
tags:
    - cordova
---

当我们知道了插件的配置，js-native交互的接口，其实我们已经知道插件应该是什么样子

当我们要开发一个插件时，写成什么样子，心里也都清楚了

问题主要就是 开发从哪里开始

## 开发方式
官方的文档没有太明确的说明，不过在[文档](http://cordova.apache.org/docs/en/latest/guide/hybrid/plugins/index.html)上
写sample插件的过程是这样的，可以作为方式1

#### 方式1

- 先写配置文件
- 然后写js接口
- 之后写native实现
- 最后再修改下配置文件

这样就结束了。

#### 方式2

另外还有一种方式（以开发android插件为例）就是

- 用plugman创建一个空实现
- 创建一个cordova工程，添加插件需要开发的平台，安装刚创建的插件
- 确定插件的js接口，写测试调用页面
- 然后用各平台的开发工具导入各平台的代码，完善各平台的插件实现
- 用各平台的开发工具编译打包测试，直到插件代码完成
- 将写好的插件实现和js代码重新抽回最开始空实现的插件
- 最后修改配置文件完成插件
- 在利用其它工程测试开发好的插件

这种方式对于native开发比较有好处，因为可以边写边测，但是要求对插件结构、cordova结构要掌握。

#### 方式3
还有一种方式，就是可以创建一个专门开发插件的native工程。
此工程中 主要模拟js调用测试，所有的插件都可以在这个工程中开发

当然插件的配置和js代码要另外写

与方式2的区别是不需要为每一个要开发的插件都创建一个cordova工程，同时js的调用也是native模拟的

像我这样离开IDE就写不好代码的人，第一种方式 完全是自虐，所以都是用后两种

## 开发过程中可能头疼的问题

#### 不懂js怎么办
作为一个程序员，多学点是好事，再不济，咱们照猫画虎也能搞定，所以可以多下几个官方或者别人的插件看看

#### 某明奇妙的不好使
有一部分原因是配置文件不对，导致安装插件后的工程里的配置并不是自己想的那样，检查一下
另外，可以使用git做本地的版本管理，方便看命令执行后哪里修改了，也方便撤销命令带来的修改

#### native代码添加、删除都要修改配置文件，要疯了
这个在持续开发，而且native代码复杂的情况下，会成倍的降低开发效率。
可以这样

- native代码引用库，插件的主要代码写在库里，因为库的配置只要framework一个标签就可以了
- 写个脚本，每次动态生成配置（这个可能花点时间，但是如果你有这个需求，绝对值）

还有一些问题，我也没有好的解决办法
比如插件安装和卸载的时候，有概率出现失败，原因都是安装或者卸载不完整，但是更进一步的原因不清楚，
导致每次出现这个问题，我都只好跑到Android工程下一个个删除插件相关的内容，方便的话，用户版本管理删除会更好
不过大部分情况下，native代码都是ignore的。。


如果你觉得还是不知道怎么写，可以看[文档](http://cordova.apache.org/docs/en/latest/guide/hybrid/plugins/index.html)